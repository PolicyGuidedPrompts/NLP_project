Also train encoder

k-shot will allow parallelism and enhance performance